<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
"http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="articlens">
	<select id="selectList" parameterType="map" resultType="article">
		select *
		from (select rowNum rn, e.* from (select ar.*, ac.member_nickname
		from
		article ar, member ac where board_num=${board_num} and
		ar.member_num =
		ac.member_num order by article_num desc) e) where rn
		between
		${startRow} and ${endRow}
	</select>
	<select id="selectMyList" parameterType="map"
		resultType="article">
		select * from (select rowNum rn, e.* from (select a.*,
		null, b.board_name from article a, board b where
		member_num=${member_num} and a.board_num = b.board_num order by
		article_date desc) e) where rn between ${startRow} and ${endRow}
	</select>
	<select id="selectSearchList" parameterType="map"
		resultType="article">
		select *
		from (select rowNum rn, e.* from (select ar.*,
		ac.member_nickname
		from
		article ar, member ac where
		board_num=${board_num} and
		ar.member_num =
		ac.member_num and
		(article_title like ${keyword} or article_content like ${keyword})
		order by article_num desc) e) where rn
		between
		${startRow} and ${endRow}
	</select>
	<select id="total" parameterType="int" resultType="int">
		select
		count(*) from article where board_num=#{board_num}
	</select>
	<select id="myTotal" parameterType="int" resultType="int">
		select
		count(*) from article where member_num=#{member_num}
	</select>
	<select id="searchTotal" parameterType="map" resultType="int">
		select
		count(*) from article where member_num=${member_num} and
		(article_title like ${keyword} or article_content like ${keyword})
	</select>
	<update id="readcount" parameterType="map">
		update article set
		article_read = article_read + 1 where board_num = ${ board_num} and
		article_num = ${ article_num}
	</update>
	<select id="select" parameterType="map" resultType="article">
		select ar.*,
		ac.member_nickname, b.board_name from article ar, member ac, board b
		where ar.board_num = ${ board_num} and ar.article_num = ${
		article_num} and ac.member_num = ar.member_num and ar.board_num =
		b.board_num
	</select>
	<insert id="insert" parameterType="article">
		<selectKey keyProperty="article_num" order="BEFORE"
			resultType="integer">
			select nvl(max(article_num), 0) + 1 article_num from
			article where board_num=#{board_num}
		</selectKey>
		insert into article values(#{board_num}, #{article_num},
		#{member_num}, #{article_title}, #{article_content}, to_char(sysdate,
		'RRRR.MM.DD HH24:MI:SS'), 0, 0
		,'n')
	</insert>
	<update id="update" parameterType="map">
		update article set
		article_title = '${article_title}', article_content =
		'${article_content}'
		where article_num = ${article_num} and board_num =
		${board_num}
	</update>
	<update id="delete" parameterType="map">
		update article set article_del
		= 'y'
		where article_num = ${article_num} and board_num = ${board_num}
	</update>
</mapper> 